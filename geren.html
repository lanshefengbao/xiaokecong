<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸ªäººåŠå°å¾®ä¼ä¸šåˆ©ç‡æµ‹ç®—å·¥å…·ï¼ˆä¿®å¤ç‰ˆï¼‰</title>
    <style>
        :root {
            --primary: #3498db;
            --primary-dark: #2980b9;
            --secondary: #2c3e50;
            --light: #ecf0f1;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --highlight: #e74c3c;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #f8f9fa, #e6f2ff);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, var(--secondary), #1a2530);
            color: white;
            padding: 30px 20px;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            padding: 25px;
            margin: 0 20px 25px;
            transition: transform 0.3s ease;
            border: 1px solid #eaeaea;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        
        .section-title {
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--primary);
            color: var(--secondary);
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -12px 15px;
        }
        
        .form-group {
            flex: 1 0 calc(50% - 24px);
            margin: 0 12px 20px;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .input-wrapper {
            position: relative;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            transition: all 0.3s;
            background-color: #fafafa;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
            background-color: white;
        }
        
        .input-unit {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
            font-size: 14px;
        }
        
        button {
            background: linear-gradient(to right, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s;
            margin-right: 15px;
            margin-top: 15px;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        #resetBtn {
            background: linear-gradient(to right, var(--secondary), #1a2530);
            box-shadow: 0 4px 10px rgba(44, 62, 80, 0.3);
        }
        
        #resetBtn:hover {
            box-shadow: 0 6px 15px rgba(44, 62, 80, 0.4);
        }
        
        .result-container {
            background: linear-gradient(135deg, #e8f4fc, #d5e9ff);
            border-radius: 10px;
            padding: 25px;
            margin: 20px;
            border-left: 5px solid var(--primary);
        }
        
        .result-title {
            color: var(--primary);
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: 700;
        }
        
        .result-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 25px;
        }
        
        .result-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05);
            flex: 1;
            min-width: 250px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .result-box:hover {
            transform: scale(1.02);
            box-shadow: 0 6px 15px rgba(0,0,0,0.08);
        }
        
        .result-label {
            font-weight: 600;
            color: var(--secondary);
            margin-bottom: 10px;
            font-size: 18px;
        }
        
        .result-value {
            font-size: 32px;
            color: var(--primary);
            font-weight: 800;
            margin: 10px 0;
        }
        
        .additional-info {
            color: #666;
            font-size: 15px;
            margin-top: 8px;
        }
        
        .config-btn {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255,255,255,0.2);
            border: none;
            padding: 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 20px;
            color: white;
            transition: all 0.3s;
        }
        
        .config-btn:hover {
            background: rgba(255,255,255,0.3);
            transform: rotate(30deg);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        
        .close {
            font-size: 28px;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: var(--danger);
        }
        
        .calculation-steps {
            margin-top: 25px;
            border-top: 1px solid #e0e0e0;
            padding-top: 25px;
        }
        
        .step {
            margin-bottom: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }
        
        .step-title {
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--secondary);
            font-size: 18px;
        }
        
        .highlight {
            color: var(--highlight);
            font-weight: 700;
            background-color: #fff5f5;
            padding: 2px 6px;
            border-radius: 4px;
        }
        
        .fix-banner {
            background: linear-gradient(to right, #e74c3c, #c0392b);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
            margin-bottom: 20px;
            border-radius: 0 0 8px 8px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 768px) {
            .form-group {
                flex: 1 0 calc(100% - 24px);
            }
            
            .result-content {
                flex-direction: column;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .section-title {
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="fix-banner">
            å·²ä¿®å¤é¢åº¦åˆ¤æ–­é—®é¢˜ - ç°åœ¨é‡‘é¢åˆ¤æ–­é€»è¾‘å®Œå…¨å‡†ç¡®
        </div>
        
        <header>
            <h1>ä¸ªäººåŠå°å¾®ä¼ä¸šè´·æ¬¾åˆ©ç‡æµ‹ç®—å·¥å…·</h1>
            <p class="subtitle">åŸºäºå®¢æˆ·ç±»å‹ã€å€Ÿæ¬¾é‡‘é¢ã€æ‹…ä¿æ–¹å¼ç­‰å¤šç»´åº¦å› ç´ ç²¾å‡†æµ‹ç®—è´·æ¬¾åˆ©ç‡</p>
            <button id="configBtn" class="config-btn">âš™ï¸</button>
        </header>
        
        <div class="card">
            <h2 class="section-title">ğŸ“ åŸºç¡€ä¿¡æ¯</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="customerType">å®¢æˆ·ç±»å‹</label>
                    <select id="customerType">
                        <option value="personal">ä¸ªäººå®¢æˆ·</option>
                        <option value="company">å°å¾®ä¼ä¸šä¸»</option>
                    </select>
                </div>
                
                <div class="form-group" id="customerCategoryContainer">
                    <label for="customerCategory">å®¢æˆ·åˆ†ç±»</label>
                    <select id="customerCategory">
                        <option value="general">ä¸€èˆ¬å®¢æˆ·</option>
                        <option value="premium">é«˜ç«¯å®¢æˆ·</option>
                        <option value="preferred">å…¶ä»–ä¼˜è´¨å®¢æˆ·</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group" id="amountContainer">
                    <label for="loanAmount">å€Ÿæ¬¾é‡‘é¢</label>
                    <div class="input-wrapper">
                        <input type="number" id="loanAmount" value="60">
                        <span class="input-unit">ä¸‡å…ƒ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="loanTerm">è´·æ¬¾æœŸé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="loanTerm" min="1" value="3">
                        <span class="input-unit">å¹´</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="section-title">ğŸ›¡ï¸ æ‹…ä¿æ–¹å¼</h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="guaranteeType">æ‹…ä¿ç±»å‹</label>
                    <select id="guaranteeType">
                        <option value="mortgage">è¶³å€¼æŠµæŠ¼</option>
                        <option value="pledge">è¶³å€¼è´¨æŠ¼</option>
                        <option value="guarantee" selected>ä¿è¯ç±»</option>
                        <option value="combo">ä¿è¯åŠ æŠµæŠ¼ç»„åˆ</option>
                    </select>
                </div>
            </div>
            
            <div id="comboContainer" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="collateralValue">æŠµæŠ¼ç‰©è¯„ä¼°ä»·å€¼</label>
                        <div class="input-wrapper">
                            <input type="number" id="collateralValue" value="100">
                            <span class="input-unit">ä¸‡å…ƒ</span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="mortgageRate">æŠµæŠ¼ç‡</label>
                        <div class="input-wrapper">
                            <input type="number" id="mortgageRate" value="70" step="5">
                            <span class="input-unit">%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="section-title">ğŸ åˆ©ç‡ä¼˜æƒ </h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="socialCardNum">å¼€ç«‹ç¤¾ä¿å¡æ•°é‡</label>
                    <input type="number" id="socialCardNum" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label for="socialCardLoan">ä½¿ç”¨ç¤¾ä¿å¡å‘æ”¾è´·æ¬¾</label>
                    <select id="socialCardLoan">
                        <option value="no">å¦</option>
                        <option value="yes">æ˜¯</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="mobileBankNum">å¼€é€šæ‰‹æœºé“¶è¡Œæ•°é‡</label>
                    <input type="number" id="mobileBankNum" value="0" min="0">
                </div>
                
                <div class="form-group">
                    <label for="aggregatePayment">å¼€é€šèšåˆæ”¯ä»˜</label>
                    <select id="aggregatePayment">
                        <option value="no">å¦</option>
                        <option value="yes">æ˜¯</option>
                    </select>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="fundsRetention">èµ„é‡‘ç•™å­˜æ—¥å‡</label>
                    <div class="input-wrapper">
                        <input type="number" id="fundsRetention" value="0" min="0" step="0.1">
                        <span class="input-unit">ä¸‡å…ƒ</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="stockAmount">è‚¡é‡‘æŒæœ‰é‡</label>
                    <div class="input-wrapper">
                        <input type="number" id="stockAmount" value="0" min="0" step="10">
                        <span class="input-unit">ä¸‡è‚¡</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2 class="section-title">ğŸ“Œ å…¶ä»–å› ç´ </h2>
            <div class="form-row">
                <div class="form-group">
                    <label for="potentialCustomer">æ˜¯å¦ä¸ºæ½œåŠ›å®¢æˆ·</label>
                    <select id="potentialCustomer">
                        <option value="no">å¦</option>
                        <option value="yes">æ˜¯</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="loanCategory">å€Ÿæ¬¾ç§ç±»</label>
                    <select id="loanCategory">
                        <option value="normal">ä¸€èˆ¬å€Ÿæ¬¾</option>
                        <option value="renewal">åŸé¢åº¦åŸæ‹…ä¿æ”¶å›å†è´·</option>
                        <option value="restructure">ç»­è´·/å€Ÿæ–°è¿˜æ—§/å€ºåŠ¡é‡ç»„</option>
                    </select>
                </div>
            </div>
            
            <div id="renewalContainer" style="display: none;">
                <div class="form-row">
                    <div class="form-group">
                        <label for="originalRate">åŸæ‰§è¡Œåˆ©ç‡</label>
                        <div class="input-wrapper">
                            <input type="number" id="originalRate" step="0.01" value="4.5">
                            <span class="input-unit">%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="form-row" style="padding: 0 20px;">
            <button id="calculateBtn">è®¡ç®—æ‰§è¡Œåˆ©ç‡</button>
            <button id="resetBtn">é‡ç½®è¡¨å•</button>
        </div>
        
        <div class="result-container">
            <div class="result-title">æµ‹ç®—ç»“æœ</div>
            <div class="result-content">
                <div class="result-box">
                    <div class="result-label">æœ€ç»ˆæ‰§è¡Œåˆ©ç‡</div>
                    <div id="finalRate" class="result-value">7.00%</div>
                    <div class="additional-info">åŸºç¡€åˆ©ç‡ + è°ƒæ•´é¡¹</div>
                </div>
                <div class="result-box">
                    <div class="result-label">LPRåŠ å‡åŸºç‚¹</div>
                    <div id="lprPoints" class="result-value">+400 BP</div>
                    <div class="additional-info">åŸºäº1å¹´æœŸLPR 3.00%</div>
                </div>
                <div class="result-box">
                    <div class="result-label">LPRå‚è€ƒæ¡£æ¬¡</div>
                    <div id="lprLevel" class="result-value">1å¹´æœŸLPR</div>
                    <div class="additional-info">è´·æ¬¾æœŸé™ â‰¤ 3å¹´</div>
                </div>
            </div>
            
            <div class="calculation-steps">
                <div class="step">
                    <div class="step-title">è¯¦ç»†è®¡ç®—è¿‡ç¨‹ï¼š</div>
                    <div id="calculationDetails">
                        <p>1. åŸºç¡€åˆ©ç‡è®¡ç®—ï¼ˆrate0ï¼‰:</p>
                        <p>&nbsp;&nbsp;â€¢ å®¢æˆ·ç±»å‹: <span class="highlight">ä¸ªäºº</span></p>
                        <p>&nbsp;&nbsp;â€¢ å®¢æˆ·åˆ†ç±»: <span class="highlight">ä¸€èˆ¬å®¢æˆ·</span></p>
                        <p>&nbsp;&nbsp;â€¢ é¢åº¦ç»´åº¦: <span class="highlight">60ä¸‡å…ƒ > 50ä¸‡å…ƒ â†’ 50ä¸‡å…ƒä»¥ä¸Š</span></p>
                        <p>&nbsp;&nbsp;â€¢ LPRåŸºå‡†: <span class="highlight">1å¹´æœŸLPR (3.00%)</span></p>
                        <p>&nbsp;&nbsp;â€¢ åŠ ç‚¹æ•°: <span class="highlight">400 BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ ç»“æœ: rate0 = 3.00% + 4.00% = <span class="highlight">7.00%</span></p>
                        
                        <p>2. æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆä¿è¯ç±»ï¼‰: rate1 = rate0 = <span class="highlight">7.00%</span></p>
                        
                        <p>3. åˆ©ç‡ä¼˜æƒ è®¡ç®—:</p>
                        <p>&nbsp;&nbsp;â€¢ ç¤¾ä¿å¡ä¼˜æƒ : 0å¼ Ã—10BP = 0BP, æœªä½¿ç”¨ç¤¾ä¿å¡æ”¾è´· = <span class="highlight">0BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ æ¸ é“ä¸šåŠ¡ä¼˜æƒ : 0ä¸ªæ‰‹æœºé“¶è¡ŒÃ—10BP = 0BP, æœªå¼€é€šèšåˆæ”¯ä»˜ = <span class="highlight">0BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ è‚¡é‡‘ä¼˜æƒ : 0ä¸‡è‚¡ Ã· 10 = 0Ã—10BP = <span class="highlight">0BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ èµ„é‡‘ç•™å­˜ä¼˜æƒ : 0ä¸‡å…ƒ â‰ˆ <span class="highlight">0BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ æ€»ä¼˜æƒ : 0 + 0 + 0 + 0 = <span class="highlight">0BP</span></p>
                        <p>&nbsp;&nbsp;â€¢ ä¼˜æƒ ååˆ©ç‡: rate2 = 7.00% - 0.00% = <span class="highlight">7.00%</span></p>
                        <p>&nbsp;&nbsp;â€¢ æœ€ä½åˆ©ç‡é™åˆ¶: ä¸ä½äº3.00%, å› æ­¤è°ƒæ•´ä¸º<span class="highlight">7.00%</span></p>
                        
                        <p>4. æ½œåŠ›å®¢æˆ·å› ç´ : éæ½œåŠ›å®¢æˆ·, åˆ©ç‡ä¸å˜ = <span class="highlight">7.00%</span></p>
                        
                        <p>5. å€Ÿæ¬¾ç§ç±»è°ƒæ•´ï¼ˆä¸€èˆ¬å€Ÿæ¬¾ï¼‰: ç›´æ¥æ‰§è¡Œè®¡ç®—ç»“æœ <span class="highlight">7.00%</span></p>
                        
                        <p>âœ… æœ€ç»ˆæ‰§è¡Œåˆ©ç‡: <span class="highlight">7.00%</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- é…ç½®æ¨¡æ€æ¡† -->
    <div id="configModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>åˆ©ç‡å‚æ•°é…ç½®</h3>
                <span class="close">&times;</span>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="lpr1y">1å¹´æœŸLPR</label>
                    <div class="input-wrapper">
                        <input type="number" id="lpr1y" step="0.01" value="3.0">
                        <span class="input-unit">%</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="lpr5y">5å¹´æœŸLPR</label>
                    <div class="input-wrapper">
                        <input type="number" id="lpr5y" step="0.01" value="3.5">
                        <span class="input-unit">%</span>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="maxSocialBenefit">ç¤¾ä¿å¡ä¼˜æƒ ä¸Šé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="maxSocialBenefit" value="50">
                        <span class="input-unit">BP</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="maxChannelBenefit">æ¸ é“ä¸šåŠ¡ä¼˜æƒ ä¸Šé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="maxChannelBenefit" value="40">
                        <span class="input-unit">BP</span>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="maxStockBenefit">è‚¡é‡‘ä¼˜æƒ ä¸Šé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="maxStockBenefit" value="50">
                        <span class="input-unit">BP</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="maxFundsBenefit">èµ„é‡‘ç•™å­˜ä¼˜æƒ ä¸Šé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="maxFundsBenefit" value="50">
                        <span class="input-unit">BP</span>
                    </div>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="maxTotalBenefit">ä¼˜æƒ æ€»é¢ä¸Šé™</label>
                    <div class="input-wrapper">
                        <input type="number" id="maxTotalBenefit" value="100">
                        <span class="input-unit">BP</span>
                    </div>
                </div>
            </div>
            
            <button style="margin-top: 20px;">ä¿å­˜é…ç½®</button>
        </div>
    </div>
    
    <script>
        // å…¨å±€é…ç½®
        let config = {
            lpr1y: 3.0, // 1å¹´æœŸLPR
            lpr5y: 3.5, // 5å¹´æœŸLPR
            maxSocialBenefit: 50, // ç¤¾ä¿å¡ä¼˜æƒ ä¸Šé™
            maxChannelBenefit: 40, // æ¸ é“ä¸šåŠ¡ä¼˜æƒ ä¸Šé™
            maxStockBenefit: 50,   // è‚¡é‡‘ä¼˜æƒ ä¸Šé™
            maxFundsBenefit: 50,   // èµ„é‡‘ç•™å­˜ä¼˜æƒ ä¸Šé™
            maxTotalBenefit: 100   // ä¼˜æƒ æ€»é¢ä¸Šé™
        };
        
        // DOMå…ƒç´ å¼•ç”¨
        const customerType = document.getElementById('customerType');
        const customerCategory = document.getElementById('customerCategory');
        const loanAmount = document.getElementById('loanAmount');
        const loanTerm = document.getElementById('loanTerm');
        const guaranteeType = document.getElementById('guaranteeType');
        const collateralValue = document.getElementById('collateralValue');
        const mortgageRate = document.getElementById('mortgageRate');
        const comboContainer = document.getElementById('comboContainer');
        const socialCardNum = document.getElementById('socialCardNum');
        const socialCardLoan = document.getElementById('socialCardLoan');
        const mobileBankNum = document.getElementById('mobileBankNum');
        const aggregatePayment = document.getElementById('aggregatePayment');
        const fundsRetention = document.getElementById('fundsRetention');
        const stockAmount = document.getElementById('stockAmount');
        const potentialCustomer = document.getElementById('potentialCustomer');
        const loanCategory = document.getElementById('loanCategory');
        const renewalContainer = document.getElementById('renewalContainer');
        const originalRate = document.getElementById('originalRate');
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const configBtn = document.getElementById('configBtn');
        const modal = document.getElementById('configModal');
        const closeBtn = document.querySelector('.close');
        const finalRate = document.getElementById('finalRate');
        const lprPoints = document.getElementById('lprPoints');
        const lprLevel = document.getElementById('lprLevel');
        const calculationDetails = document.getElementById('calculationDetails');
        
        // äº‹ä»¶ç›‘å¬
        customerType.addEventListener('change', updateFormFields);
        guaranteeType.addEventListener('change', toggleComboFields);
        loanCategory.addEventListener('change', toggleRenewalFields);
        calculateBtn.addEventListener('click', calculateRate);
        resetBtn.addEventListener('click', resetForm);
        configBtn.addEventListener('click', openConfigModal);
        closeBtn.addEventListener('click', closeConfigModal);
        
        // å…³é—­æ¨¡æ€æ¡† - ç‚¹å‡»èƒŒæ™¯åŒºåŸŸ
        window.addEventListener('click', (event) => {
            if (event.target === modal) {
                closeConfigModal();
            }
        });
        
        // åˆå§‹åŒ–è¡¨å•å­—æ®µ
        function updateFormFields() {
            const isPersonal = customerType.value === 'personal';
            const companyContainer = document.getElementById('customerCategoryContainer');
            const amountContainer = document.getElementById('amountContainer');
            
            // ä¸ªäººå®¢æˆ·å’Œä¼ä¸šå®¢æˆ·å­—æ®µé€»è¾‘
            if (isPersonal) {
                companyContainer.style.display = 'block';
                loanAmount.value = '60';
            } else {
                companyContainer.style.display = 'none';
                loanAmount.value = '200';
            }
        }
        
        // æ˜¾ç¤º/éšè—ç»„åˆæ‹…ä¿å­—æ®µ
        function toggleComboFields() {
            const isCombo = guaranteeType.value === 'combo';
            comboContainer.style.display = isCombo ? 'block' : 'none';
        }
        
        // æ˜¾ç¤º/éšè—åŸåˆ©ç‡å­—æ®µ
        function toggleRenewalFields() {
            const isRenewal = loanCategory.value !== 'normal';
            renewalContainer.style.display = isRenewal ? 'block' : 'none';
        }
        
        // æ‰“å¼€é…ç½®æ¨¡æ€æ¡†
        function openConfigModal() {
            // è®¾ç½®è¡¨å•å€¼ä¸ºå½“å‰é…ç½®
            document.getElementById('lpr1y').value = config.lpr1y;
            document.getElementById('lpr5y').value = config.lpr5y;
            document.getElementById('maxSocialBenefit').value = config.maxSocialBenefit;
            document.getElementById('maxChannelBenefit').value = config.maxChannelBenefit;
            document.getElementById('maxStockBenefit').value = config.maxStockBenefit;
            document.getElementById('maxFundsBenefit').value = config.maxFundsBenefit;
            document.getElementById('maxTotalBenefit').value = config.maxTotalBenefit;
            
            modal.style.display = 'flex';
        }
        
        // å…³é—­é…ç½®æ¨¡æ€æ¡†
        function closeConfigModal() {
            modal.style.display = 'none';
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            customerType.value = 'personal';
            customerCategory.value = 'general';
            loanAmount.value = '60';
            loanTerm.value = '3';
            guaranteeType.value = 'guarantee';
            comboContainer.style.display = 'none';
            collateralValue.value = '100';
            mortgageRate.value = '70';
            socialCardNum.value = '0';
            socialCardLoan.value = 'no';
            mobileBankNum.value = '0';
            aggregatePayment.value = 'no';
            fundsRetention.value = '0';
            stockAmount.value = '0';
            potentialCustomer.value = 'no';
            loanCategory.value = 'normal';
            renewalContainer.style.display = 'none';
            originalRate.value = '4.5';
            
            calculateRate();
        }
        
        // è®¡ç®—åˆ©ç‡
        function calculateRate() {
            // è·å–è¡¨å•å€¼
            const amount = parseFloat(loanAmount.value) || 0;
            const term = parseFloat(loanTerm.value) || 3;
            
            // ç¬¬ä¸€æ­¥ï¼šç¡®å®šåŸºç¡€åˆ©ç‡ï¼ˆrate0ï¼‰
            let rate0 = calculateBaseRate(amount, term);
            let basePoints = calculateBasePoints(amount, term);
            
            const isPersonal = customerType.value === 'personal';
            const amountThreshold = isPersonal ? 50 : 200;
            const amountDesc = amount <= amountThreshold ? 
                `${amountThreshold}ä¸‡å…ƒåŠä»¥ä¸‹` : 
                `${amountThreshold}ä¸‡å…ƒä»¥ä¸Š`;
            
            let details = `<p>1. åŸºç¡€åˆ©ç‡è®¡ç®—ï¼ˆrate0ï¼‰:</p>`;
            details += `<p>&nbsp;&nbsp;â€¢ å®¢æˆ·ç±»å‹: <span class="highlight">${isPersonal ? 'ä¸ªäºº' : 'å°å¾®ä¼ä¸š'}</span></p>`;
            if (isPersonal) {
                details += `<p>&nbsp;&nbsp;â€¢ å®¢æˆ·åˆ†ç±»: <span class="highlight">${getCustomerCategoryName()}</span></p>`;
            }
            details += `<p>&nbsp;&nbsp;â€¢ é¢åº¦ç»´åº¦: <span class="highlight">${amount}ä¸‡å…ƒ ${amount <= amountThreshold ? 'â‰¤' : '>'} ${amountThreshold}ä¸‡å…ƒ â†’ ${amountDesc}</span></p>`;
            
            const referenceLPR = term <= 3 ? config.lpr1y : config.lpr5y;
            const lprDesc = term <= 3 ? 
                `1å¹´æœŸLPR (${config.lpr1y}%)` : 
                `5å¹´æœŸLPR (${config.lpr5y}%)`;
                
            details += `<p>&nbsp;&nbsp;â€¢ LPRåŸºå‡†: <span class="highlight">${lprDesc}</span></p>`;
            details += `<p>&nbsp;&nbsp;â€¢ åŠ ç‚¹æ•°: <span class="highlight">${basePoints} BP</span></p>`;
            details += `<p>&nbsp;&nbsp;â€¢ ç»“æœ: rate0 = ${referenceLPR}% + ${basePoints/100}% = <span class="highlight">${rate0.toFixed(2)}%</span></p>`;
            
            // ç¬¬äºŒæ­¥ï¼šæ ¹æ®æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆrate1ï¼‰
            const gType = guaranteeType.value;
            let rate1 = rate0;
            
            switch(gType) {
                case 'mortgage':
                    rate1 = rate0 - 1.0; // å‡100BP
                    details += `<p>2. æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆè¶³å€¼æŠµæŠ¼ï¼‰: rate1 = ${rate0.toFixed(2)}% - 100BP = <span class="highlight">${rate1.toFixed(2)}%</span></p>`;
                    break;
                case 'pledge':
                    rate1 = 3.5; // ç›´æ¥æ‰§è¡Œ3.5%
                    details += `<p>2. æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆè¶³å€¼è´¨æŠ¼ï¼‰: ç›´æ¥æ‰§è¡Œ<span class="highlight">3.5%</span></p>`;
                    break;
                case 'guarantee':
                    details += `<p>2. æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆä¿è¯ç±»ï¼‰: rate1 = rate0 = <span class="highlight">${rate1.toFixed(2)}%</span></p>`;
                    break;
                case 'combo':
                    const collateralVal = parseFloat(collateralValue.value) || 0;
                    const mortgageR = parseFloat(mortgageRate.value) / 100 || 0.7;
                    
                    // æŠµæŠ¼éƒ¨åˆ†è´·æ¬¾é¢åº¦ = min(æŠµæŠ¼ç‰©ä»·å€¼ * æŠµæŠ¼ç‡, è´·æ¬¾é‡‘é¢)
                    const mortgageAmount = Math.min(collateralVal * mortgageR, amount);
                    
                    // ä¿è¯éƒ¨åˆ†è´·æ¬¾é¢åº¦ = è´·æ¬¾æ€»é¢ - æŠµæŠ¼éƒ¨åˆ†é¢åº¦
                    const guaranteeAmount = amount - mortgageAmount;
                    
                    // æŠµæŠ¼éƒ¨åˆ†æ‰§è¡Œåˆ©ç‡ = rate0 - 1.0%
                    const mortgageRateValue = rate0 - 1.0;
                    
                    // åŠ æƒå¹³å‡è®¡ç®—æ•´ä½“åˆ©ç‡
                    rate1 = (guaranteeAmount * rate0 + mortgageAmount * mortgageRateValue) / amount;
                    
                    details += `<p>2. æ‹…ä¿æ–¹å¼è°ƒæ•´ï¼ˆä¿è¯+æŠµæŠ¼ç»„åˆï¼‰:</p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ æŠµæŠ¼ç‰©è¯„ä¼°ä»·å€¼: <span class="highlight">${collateralVal}ä¸‡å…ƒ</span></p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ æŠµæŠ¼ç‡: <span class="highlight">${(mortgageR*100).toFixed(0)}%</span></p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ å¯æ‹…ä¿é¢åº¦: <span class="highlight">${(collateralVal * mortgageR).toFixed(2)}ä¸‡å…ƒ</span></p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ æŠµæŠ¼éƒ¨åˆ†é‡‘é¢: <span class="highlight">${mortgageAmount.toFixed(2)}ä¸‡å…ƒ</span>, æ‰§è¡Œåˆ©ç‡: <span class="highlight">${mortgageRateValue.toFixed(2)}%</span></p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ ä¿è¯éƒ¨åˆ†é‡‘é¢: <span class="highlight">${guaranteeAmount.toFixed(2)}ä¸‡å…ƒ</span>, æ‰§è¡Œåˆ©ç‡: <span class="highlight">${rate0.toFixed(2)}%</span></p>`;
                    details += `<p>&nbsp;&nbsp;â€¢ åŠ æƒè®¡ç®—: rate1 = (${guaranteeAmount.toFixed(2)}Ã—${rate0.toFixed(2)}% + ${mortgageAmount.toFixed(2)}Ã—${mortgageRateValue.toFixed(2)}%)/${amount} = <span class="highlight">${rate1.toFixed(3)}%</span></p>`;
                    break;
            }
            
            // ç¬¬ä¸‰æ­¥ï¼šè®¡ç®—å„é¡¹ä¼˜æƒ ï¼ˆrate2ï¼‰
            let socialBenefit = 0;
            // ç¤¾ä¿å¡æ•°é‡ä¼˜æƒ ï¼ˆæ¯å¼ 10BPï¼‰
            const numCards = parseInt(socialCardNum.value) || 0;
            socialBenefit += numCards * 10;
            
            // ä½¿ç”¨ç¤¾ä¿å¡å‘æ”¾è´·æ¬¾ä¼˜æƒ 
            if (socialCardLoan.value === 'yes') socialBenefit += 10;
            
            // é™åˆ¶ç¤¾ä¿å¡æ€»ä¼˜æƒ 
            socialBenefit = Math.min(socialBenefit, config.maxSocialBenefit);
            
            // æ¸ é“ä¸šåŠ¡ä¼˜æƒ 
            let channelBenefit = 0;
            const numMobileBank = parseInt(mobileBankNum.value) || 0;
            channelBenefit += numMobileBank * 10;
            if (aggregatePayment.value === 'yes') channelBenefit += 20;
            channelBenefit = Math.min(channelBenefit, config.maxChannelBenefit);
            
            // è‚¡é‡‘ä¼˜æƒ 
            const stock = parseInt(stockAmount.value) || 0;
            let stockBenefit = Math.floor(stock / 10) * 10; // æ¯10ä¸‡è‚¡ä¼˜æƒ 10BP
            stockBenefit = Math.min(stockBenefit, config.maxStockBenefit);
            
            // èµ„é‡‘ç•™å­˜ä¼˜æƒ 
            const funds = parseFloat(fundsRetention.value) || 0;
            let fundsBenefit = Math.floor(funds); // æ¯ä¸‡å…ƒä¼˜æƒ 1BP
            fundsBenefit = Math.min(fundsBenefit, config.maxFundsBenefit);
            
            // æ€»ä¼˜æƒ è®¡ç®—
            const totalBenefitBP = socialBenefit + channelBenefit + stockBenefit + fundsBenefit;
            const cappedBenefit = Math.min(totalBenefitBP, config.maxTotalBenefit);
            const rate2 = rate1 - cappedBenefit / 100; // è½¬æ¢ä¸ºç™¾åˆ†æ¯”
            
            // ç¡®ä¿ä¸ä½äºåŒæ¡£æ¬¡LPR
            const minRate = term <= 3 ? config.lpr1y : config.lpr5y;
            const finalRateBeforePotential = Math.max(rate2, minRate);
            
            details += `<p>3. åˆ©ç‡ä¼˜æƒ è®¡ç®—:</p>`;
            details += `<p>&nbsp;&nbsp;â€¢ ç¤¾ä¿å¡ä¼˜æƒ : ${numCards}å¼ Ã—10BP = ${numCards * 10}BP, `;
            details += socialCardLoan.value === 'yes' ? 'ä½¿ç”¨ç¤¾ä¿å¡æ”¾è´· +10BP = ' : 'æœªä½¿ç”¨ç¤¾ä¿å¡æ”¾è´· = ';
            details += `<span class="highlight">${socialBenefit}BP</span> (æœ€é«˜${config.maxSocialBenefit}BP)</p>`;
            
            details += `<p>&nbsp;&nbsp;â€¢ æ¸ é“ä¸šåŠ¡ä¼˜æƒ : ${numMobileBank}ä¸ªæ‰‹æœºé“¶è¡ŒÃ—10BP = ${numMobileBank * 10}BP, `;
            details += aggregatePayment.value === 'yes' ? 'å¼€é€šèšåˆæ”¯ä»˜ +20BP = ' : 'æœªå¼€é€šèšåˆæ”¯ä»˜ = ';
            details += `<span class="highlight">${channelBenefit}BP</span> (æœ€é«˜${config.maxChannelBenefit}BP)</p>`;
            
            details += `<p>&nbsp;&nbsp;â€¢ è‚¡é‡‘ä¼˜æƒ : ${stock}ä¸‡è‚¡ Ã· 10 = ${Math.floor(stock / 10)}Ã—10BP = <span class="highlight">${stockBenefit}BP</span> (æœ€é«˜${config.maxStockBenefit}BP)</p>`;
            
            details += `<p>&nbsp;&nbsp;â€¢ èµ„é‡‘ç•™å­˜ä¼˜æƒ : ${funds}ä¸‡å…ƒ â‰ˆ ${Math.floor(funds)}BP = <span class="highlight">${fundsBenefit}BP</span> (æœ€é«˜${config.maxFundsBenefit}BP)</p>`;
            
            details += `<p>&nbsp;&nbsp;â€¢ æ€»ä¼˜æƒ : ${socialBenefit} + ${channelBenefit} + ${stockBenefit} + ${fundsBenefit} = <span class="highlight">${totalBenefitBP}BP</span></p>`;
            details += `<p>&nbsp;&nbsp;â€¢ ä¼˜æƒ é™åˆ¶: æ‰€æœ‰ä¼˜æƒ ç´¯è®¡ä¸Šé™${config.maxTotalBenefit}BP</p>`;
            details += `<p>&nbsp;&nbsp;â€¢ æœ€ç»ˆä¼˜æƒ : <span class="highlight">${cappedBenefit}BP</span></p>`;
            details += `<p>&nbsp;&nbsp;â€¢ ä¼˜æƒ ååˆ©ç‡: rate2 = ${rate1.toFixed(2)}% - ${cappedBenefit/100}% = <span class="highlight">${rate2.toFixed(3)}%</span></p>`;
            details += `<p>&nbsp;&nbsp;â€¢ æœ€ä½åˆ©ç‡é™åˆ¶: ä¸ä½äº${minRate}%, å› æ­¤è°ƒæ•´ä¸º<span class="highlight">${finalRateBeforePotential.toFixed(3)}%</span></p>`;
            
            // ç¬¬å››æ­¥ï¼šè€ƒè™‘æ½œåŠ›å®¢æˆ·ï¼ˆrate3ï¼‰
            let rate3 = finalRateBeforePotential;
            if (potentialCustomer.value === 'yes') {
                rate3 += 0.5; // åŠ 50BP
                details += `<p>4. æ½œåŠ›å®¢æˆ·å› ç´ : åŠ 50BP = <span class="highlight">${rate3.toFixed(3)}%</span></p>`;
            } else {
                details += `<p>4. æ½œåŠ›å®¢æˆ·å› ç´ : éæ½œåŠ›å®¢æˆ·, åˆ©ç‡ä¸å˜ = <span class="highlight">${rate3.toFixed(3)}%</span></p>`;
            }
            
            // ç¬¬äº”æ­¥ï¼šå€Ÿæ¬¾ç§ç±»è°ƒæ•´ï¼ˆrate4ï¼‰
            const loanType = loanCategory.value;
            let finalRateValue = rate3;
            
            if (loanType === 'renewal') {
                const original = parseFloat(originalRate.value) || 0;
                const renewalRate = original + 0.5; // åŠ 50BP
                finalRateValue = Math.min(renewalRate, rate3);
                
                details += `<p>5. å€Ÿæ¬¾ç§ç±»è°ƒæ•´ï¼ˆåŸé¢åº¦åŸæ‹…ä¿æ”¶å›å†è´·ï¼‰:</p>`;
                details += `<p>&nbsp;&nbsp;â€¢ åŸæ‰§è¡Œåˆ©ç‡: ${original}% + 50BP = <span class="highlight">${renewalRate}%</span></p>`;
                details += `<p>&nbsp;&nbsp;â€¢ ä¸å½“å‰è®¡ç®—ç»“æœæ¯”è¾ƒå­°ä½: min(${renewalRate}%, ${rate3.toFixed(2)}%) = <span class="highlight">${finalRateValue.toFixed(3)}%</span></p>`;
            } else if (loanType === 'restructure') {
                const original = parseFloat(originalRate.value) || 0;
                finalRateValue = original - 1.0; // å‡100BP
                
                details += `<p>5. å€Ÿæ¬¾ç§ç±»è°ƒæ•´ï¼ˆç»­è´·/å€Ÿæ–°è¿˜æ—§/å€ºåŠ¡é‡ç»„ï¼‰: ${original}% - 100BP = <span class="highlight">${finalRateValue.toFixed(3)}%</span></p>`;
            } else {
                details += `<p>5. å€Ÿæ¬¾ç§ç±»è°ƒæ•´ï¼ˆä¸€èˆ¬å€Ÿæ¬¾ï¼‰: ç›´æ¥æ‰§è¡Œè®¡ç®—ç»“æœ <span class="highlight">${finalRateValue.toFixed(3)}%</span></p>`;
            }
            
            // æœ€ç»ˆè¾“å‡º
            finalRateValue = Math.round(finalRateValue * 100) / 100; // ä¿ç•™ä¸¤ä½å°æ•°
            const referenceLPRFinal = term <= 3 ? config.lpr1y : config.lpr5y;
            const points = Math.round((finalRateValue - referenceLPRFinal) * 100); // åŸºç‚¹ = (åˆ©ç‡å·®) * 100
            
            finalRate.textContent = finalRateValue.toFixed(2) + '%';
            lprPoints.textContent = (points >= 0 ? '+' : '') + points + ' BP';
            lprLevel.textContent = term <= 3 ? '1å¹´æœŸLPR' : '5å¹´æœŸLPR';
            
            details += `<p>âœ… æœ€ç»ˆæ‰§è¡Œåˆ©ç‡: <span class="highlight">${finalRateValue.toFixed(2)}%</span></p>`;
            calculationDetails.innerHTML = details;
        }
        
        // åŸºç¡€åˆ©ç‡è®¡ç®—ï¼ˆrate0ï¼‰
        function calculateBaseRate(amount, term) {
            let basePoints = 0;
            
            if (customerType.value === 'personal') {
                if (amount <= 50) { // 50ä¸‡å…ƒåŠä»¥ä¸‹
                    switch(customerCategory.value) {
                        case 'general': basePoints = 350; break;
                        case 'premium': basePoints = 50; break;
                        case 'preferred': basePoints = 100; break;
                    }
                } else { // 50ä¸‡å…ƒä»¥ä¸Š
                    switch(customerCategory.value) {
                        case 'general': basePoints = 400; break;
                        case 'premium': basePoints = 100; break;
                        case 'preferred': basePoints = 150; break;
                    }
                }
            } else { // å°å¾®ä¼ä¸šä¸»
                basePoints = amount <= 200 ? 300 : 350;
            }
            
            const referenceLPR = term <= 3 ? config.lpr1y : config.lpr5y;
            return referenceLPR + basePoints / 100;
        }
        
        // åŸºç¡€åŠ ç‚¹æ•°è®¡ç®—
        function calculateBasePoints(amount, term) {
            let basePoints = 0;
            
            if (customerType.value === 'personal') {
                if (amount <= 50) { // 50ä¸‡å…ƒåŠä»¥ä¸‹
                    switch(customerCategory.value) {
                        case 'general': basePoints = 350; break;
                        case 'premium': basePoints = 50; break;
                        case 'preferred': basePoints = 100; break;
                    }
                } else { // 50ä¸‡å…ƒä»¥ä¸Š
                    switch(customerCategory.value) {
                        case 'general': basePoints = 400; break;
                        case 'premium': basePoints = 100; break;
                        case 'preferred': basePoints = 150; break;
                    }
                }
            } else { // å°å¾®ä¼ä¸šä¸»
                basePoints = amount <= 200 ? 300 : 350;
            }
            
            return basePoints;
        }
        
        // è·å–å®¢æˆ·åˆ†ç±»çš„åç§°
        function getCustomerCategoryName() {
            switch(customerCategory.value) {
                case 'general': return 'ä¸€èˆ¬å®¢æˆ·';
                case 'premium': return 'é«˜ç«¯å®¢æˆ·';
                case 'preferred': return 'å…¶ä»–ä¼˜è´¨å®¢æˆ·';
                default: return '';
            }
        }
        
        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            updateFormFields();
            toggleComboFields();
            toggleRenewalFields();
            calculateRate(); // åˆå§‹è®¡ç®—
        });
    </script>
</body>
</html>